// Niri configuration converted from Sway

// Input configuration
input {
    keyboard {
        xkb {
            options "ctrl:nocaps"
        }
        
        repeat-delay 200
        repeat-rate 25
    }
    
    touchpad {
        tap
        natural-scroll false
        dwt
        middle-emulation
        accel-profile "adaptive"
        accel-speed 1.0
    }
    
    // This replicates Sway's focus behavior
    focus-follows-mouse
}

// Output/monitor configuration
output "eDP-1" {
    scale 1.5
}

// Launch wallpaper
spawn-at-startup "swaybg" "-i" "~/.dotfiles/wallpaper/space.png" "-m" "fill"

// Layout configuration
layout {
    // Gaps between windows (inner gaps in Sway)
    gaps 20
    
    // Border width (equivalent to Sway's pixel border)
    border-width 2
    
    // Focus indication (equivalent to Sway's focused border color)
    focus-ring {
        enabled
        color "#7fbbb3"
        width 2
    }
    
    // Configure colors similar to Sway colors
    border-color "#32302f"
    
    // No outer gaps in Niri by default
    struts {
        left 0
        right 0
        top 0
        bottom 0
    }
}

// Window Rules - similar to Sway's for_window rules
window-rules {
    // Floating windows
    window window-type="dialog" {
        floating
        position 5 5
        size 320 240
    }
    
    window window-type="menu" {
        floating
        position 5 5
        size 320 240
    }
    
    window role="pop-up" {
        floating
        position 5 5
        size 320 240
    }
    
    window role="task_dialog" {
        floating
        position 5 5
        size 320 240
    }
    
    window role="bubble" {
        floating
        position 5 5
        size 320 240
    }
    
    window role="Preferences" {
        floating
        position 5 5
        size 320 240
    }
}

// Key bindings - converting Sway bindsym to Niri binds
binds {
    // Terminal
    Mod4+Return { spawn "/usr/bin/ghostty" }
    
    // Kill window
    Mod4+Shift+q { action close-window }
    
    // Screenshot
    Mod4+Shift+s { spawn "grim" "-g" "$(slurp)" "-" "|" "wl-copy" }
    
    // App launcher
    Mod4+d { spawn "~/.config/wofi/launcher.sh" }
    
    // Focus movement - in Niri, navigation is between columns and within columns
    Mod4+h { action focus-column-left }
    Mod4+j { action focus-window-down }
    Mod4+k { action focus-window-up }
    Mod4+l { action focus-column-right }
    
    // Arrow keys for focus
    Mod4+Left { action focus-column-left }
    Mod4+Down { action focus-window-down }
    Mod4+Up { action focus-window-up }
    Mod4+Right { action focus-column-right }
    
    // Moving windows
    Mod4+Shift+h { action move-window-left }
    Mod4+Shift+j { action move-window-down }
    Mod4+Shift+k { action move-window-up }
    Mod4+Shift+l { action move-window-right }
    
    // Arrow keys for moving windows
    Mod4+Shift+Left { action move-window-left }
    Mod4+Shift+Down { action move-window-down }
    Mod4+Shift+Up { action move-window-up }
    Mod4+Shift+Right { action move-window-right }
    
    // Layout manipulation
    Mod4+c { action consume-window-into-column }  // Similar to split h
    Mod4+v { spawn "notify-send" "Vertical split not applicable in Niri's model" }
    
    // Fullscreen
    Mod4+f { action toggle-fullscreen }
    
    // Layout toggle - Niri's layout is different from Sway, so this is approximate
    Mod4+e { action toggle-tabbed-column }
    
    // Floating toggle
    Mod4+Shift+space { action toggle-floating }
    
    // Focus toggle
    Mod4+space { action toggle-floating-focus }
    
    // Audio controls
    XF86AudioRaiseVolume { spawn "pactl" "set-sink-volume" "@DEFAULT_SINK@" "+1%" }
    XF86AudioLowerVolume { spawn "pactl" "set-sink-volume" "@DEFAULT_SINK@" "-1%" }
    XF86AudioMute { spawn "pactl" "set-sink-mute" "@DEFAULT_SINK@" "toggle" }
    
    // Workspace switching - Niri uses numeric workspaces
    Mod4+1 { action workspace-switch 1 }
    Mod4+2 { action workspace-switch 2 }
    Mod4+3 { action workspace-switch 3 }
    Mod4+4 { action workspace-switch 4 }
    Mod4+5 { action workspace-switch 5 }
    Mod4+6 { action workspace-switch 6 }
    Mod4+7 { action workspace-switch 7 }
    Mod4+8 { action workspace-switch 8 }
    Mod4+9 { action workspace-switch 9 }
    Mod4+0 { action workspace-switch 10 }
    
    // Move container to workspace
    Mod4+Shift+1 { action window-move-to-workspace 1 }
    Mod4+Shift+2 { action window-move-to-workspace 2 }
    Mod4+Shift+3 { action window-move-to-workspace 3 }
    Mod4+Shift+4 { action window-move-to-workspace 4 }
    Mod4+Shift+5 { action window-move-to-workspace 5 }
    Mod4+Shift+6 { action window-move-to-workspace 6 }
    Mod4+Shift+7 { action window-move-to-workspace 7 }
    Mod4+Shift+8 { action window-move-to-workspace 8 }
    Mod4+Shift+9 { action window-move-to-workspace 9 }
    Mod4+Shift+0 { action window-move-to-workspace 10 }
    
    // Config reload
    Mod4+Shift+c { action reload-config }
    
    // Restart - not directly applicable in Niri but reload config is similar
    Mod4+Shift+r { action reload-config }
    
    // Exit Niri - Niri has a direct quit action
    Mod4+Shift+e { spawn "~/.config/waybar/launch-shutdown-bar.sh" }
    
    // Resize mode in Niri - there are direct resize actions instead of a mode
    Mod4+r {
        // This will show a notification instead of entering a resize mode
        spawn "notify-send" "Niri uses direct resize actions - try Mod4+r+arrow keys"
    }
    
    // Resize actions
    Mod4+r+h { action resize left -10 }
    Mod4+r+j { action resize down +10 }
    Mod4+r+k { action resize up -10 }
    Mod4+r+l { action resize right +10 }
    
    // Resize with arrow keys
    Mod4+r+Left { action resize left -10 }
    Mod4+r+Down { action resize down +10 }
    Mod4+r+Up { action resize up -10 }
    Mod4+r+Right { action resize right +10 }
    
    // Window marking - Using similar approach with Wofi
    Mod4+m { spawn "swaymsg" "mark" "$(wofi --dmenu -p 'Mark window:' -L 1)" }
    Mod4+g { spawn "swaymsg" "[con_mark=$(wofi --dmenu -p 'Goto mark:' -L 1)]" "focus" }
    Mod4+u { spawn "swaymsg" "unmark" "$(wofi --dmenu -p 'Unmark window:' -L 1)" }
}

// Autostart applications
spawn-at-startup "mako"
spawn-at-startup "~/.config/waybar/launch-bar.sh"
spawn-at-startup "systemctl" "--user" "import-environment" "DISPLAY" "WAYLAND_DISPLAY" "SWAYSOCK"
spawn-at-startup "dbus-update-activation-environment" "--systemd" "DISPLAY" "WAYLAND_DISPLAY" "SWAYSOCK"
spawn-at-startup "/usr/libexec/xdg-desktop-portal" "-r"

// Application startup
spawn-at-startup "swayidle" "-w" "timeout" "300" "swaylock -f -i ~/.dotfiles/wallpaper/space.png" "timeout" "600" "niri msg action power-off-monitors" "resume" "niri msg action power-on-monitors" "before-sleep" "swaylock -f -i ~/.dotfiles/wallpaper/space.png"

// Start applications in specific workspaces
// Note: The syntax below uses a shell script to handle workspace switching with application launching
spawn-at-startup "sh" "-c" "sleep 1 && niri msg action workspace-switch 1 && /usr/bin/ghostty"
spawn-at-startup "sh" "-c" "sleep 2 && niri msg action workspace-switch 2 && firefox"
spawn-at-startup "sh" "-c" "sleep 3 && niri msg action workspace-switch 3 && flatpak run com.slack.Slack"
spawn-at-startup "sh" "-c" "sleep 4 && niri msg action workspace-switch 4 && flatpak run com.spotify.Client"
spawn-at-startup "sh" "-c" "sleep 5 && niri msg action workspace-switch 5 && flatpak run md.obsidian.Obsidian"

// Animations
animations {
    workspace-switch-duration 250
}

// Preferences
prefer-no-csd

// Environment variables
environment {
    // Add your environment variables here
}
