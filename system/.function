# rp - rake parallel tasks
function rp () {
  bundle exec rake parallel:features[4,${*},'--format progress']
}

function mk() {
    mkdir -p "$@" && cd "$@"
}

assume() {
    role=$1
    local creds=$(aws sts assume-role --role-arn arn:aws:iam::496584544324:role/$role --role-session-name role-assume-test)
    echo $creds
    export AWS_SESSION_TOKEN=$(echo $creds|jq -r '.[].SessionToken'|tr -d "\n"|sed 's/null//')
    export AWS_ACCESS_KEY_ID=$(echo -n $creds|jq -r '.[].AccessKeyId'|tr -d "\n"|sed 's/null//')
    export AWS_SECRET_ACCESS_KEY=$(echo -n $creds|jq -r '.[].SecretAccessKey'|tr -d "\n"|sed 's/null//')
}

# Show 256 TERM colors
colors() {
  local X=$(tput op)
  local Y=$(printf %$((COLUMNS-6))s)
  for i in {0..256}; do
  o=00$i;
  echo -e ${o:${#o}-3:3} $(tput setaf $i;tput setab $i)${Y// /=}$X;
  done
}

# Add to path
prepend-path() {
  [ -d $1 ] && PATH="$1:$PATH"
}

# only run black on python files
gblack() {
    git diff --name-only $(git branch --show-current) $(git merge-base $(git branch --show-current) master) | xargs -I{} find {} -name "*.py" -exec black -l 120 {} \;
}

# print all aliases
aliases() {
    bat $HOME/.dotfiles/system/.alias
}

create_venv() {
    python -m venv .
    echo "layout python" >> .envrc
    direnv allow
}

cgls () {
    gcl $1 ~/cbi/services/
}

cglj () {
    gcl $1 ~/cbi/jobs/
}
